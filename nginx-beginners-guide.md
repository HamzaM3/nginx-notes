for # NGINX beginner's guide 

nginx has one master process and worker proceses

main process -> handles config and maintains workers
workers - receive requests

event-based model

nb of workers etc specified by config

config is called `nginx.conf`
in `/usr/local/nginx/conf` or `/etc/nginx` or `/usr/local/etc/nginx`

## Starting, Stopping, and Reloading Configuration

```
nginx -s <signal>
```

with `signal`:
- stop : fast shutdown
- quit : graceful shutdown
- reload : reload the config file
- reopen : reopen the log files (?)


> These command has to be executed by the same user

reload => ( syntax validity -> new workers and old worker shut down after treating current requests )

You can use ps and kill to manipulate nginx (linux stuff)

## Configuration Fileâ€™s Structure

nginx = modules controlled by directives in config file

directives = either simple or block

simple directive = name + parameters separated with spaces + semicolon

block directive = name + parameters separated with spaces + curly braces with instructions/directives (called context)

(exemple of directives: events, http, server and location)

main context = outside of any context

The `events` and `http` directives reside in the `main` context, `server` in `http`, and `location` in `server`. 

comments = # ...

## Serving Static Content

Exercise 1: set up a server that serves html files located in `/data/www` and images in `/data/images`

Solution is of the form : http > server > location x2

(use `docker`  to test things)

1. create the directories and fill it a little bit
2. http { server {} }
  - multiple server blocks for each ports and server name
3. location / { root /data/www; } location /images/ { root /data; }

NGINX tests: protocol > port > server name > location

> `access.log` and `error.log` allow to see why nginx didn't work

## Setting Up a Simple Proxy Server

Proxy server = server that takes requests forward them to another one and sends its response

Exercise 2: set up a proxy server
```
server {
    listen 8080;
    root /data/up1;

    location / { }
}

server {
    location / {
        proxy_pass http://localhost:8080;
    }

    location ~ \.(gif|jpg|png)$ {
        root /data/images;
    }
}
```
Question: is the 8080 port accessible from outside the machine ?
Answer:

Location matching algorithm:
if a regex match: one of the regex; else: one of the longest prefix

## Setting Up FastCGI Proxying

FastCGI = servers that cache files generated by PHP (for ex) to avoid recalculating

Suppose FastCGI listens to port 9000
Solution:
```
server {
    location / {
        fastcgi_pass  localhost:9000;
        fastcgi_param SCRIPT_FILENAME $document_root$fastcgi_script_name;
        fastcgi_param QUERY_STRING    $query_string;
    }

    location ~ \.(gif|jpg|png)$ {
        root /data/images;
    }
}
```

